<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>راهنمای کدبیس NFT Monitoring</title>
  <style>
    body { font-family: "Vazirmatn", "Segoe UI", sans-serif; line-height: 1.7; direction: rtl; padding: 2rem; background: #f8fafc; color: #0f172a; }
    h1, h2, h3 { color: #0f172a; }
    code { background: #e2e8f0; padding: 0.15rem 0.35rem; border-radius: 4px; }
    .card { background: #ffffff; border-radius: 12px; padding: 1.5rem; box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08); margin-bottom: 1.5rem; }
    .mermaid { background: #ffffff; border-radius: 12px; padding: 1rem; }
  </style>
</head>
<body>
  <h1>راهنمای سریع برای تازه‌واردها</h1>

  <div class="card">
    <h2>هدف کلی</h2>
    <p>
      پروژه <strong>NFT Monitoring</strong> یک داشبورد مبتنی بر Vite/React است که داده‌های زنده سنسورهای سامانه هیدروپونیک را از طریق STOMP/WebSocket و API دریافت می‌کند و در صفحات مختلف (نمای کلی، زنده، گزارش‌ها، دوربین‌ها و پیکربندی سنسورها) نمایش می‌دهد.
    </p>
  </div>

  <div class="card">
    <h2>ساختار و جریان اصلی</h2>
    <ul>
      <li><strong>نقطه شروع:</strong> فایل <code>src/index.jsx</code> برنامه را با <code>ReactDOM</code> اجرا می‌کند و همه چیز را داخل <code>SensorConfigProvider</code> قرار می‌دهد تا مقادیر و محدودهٔ سنسورها قابل ویرایش باشد.</li>
      <li><strong>مسیرها:</strong> فایل <code>src/App.jsx</code> مسیربندی را تعریف می‌کند؛ همهٔ مسیرها زیر <code>MainLayout</code> قرار می‌گیرند که سایدبار و <code>ReportsFiltersProvider</code> را در اختیار صفحات می‌گذارد و سپس با <code>&lt;Outlet /&gt;</code> محتوای صفحهٔ مربوطه را رندر می‌کند.</li>
      <li><strong>صفحات:</strong> پوشهٔ <code>src/pages</code> کد هر صفحه را دارد (مثلاً Overview، Live، Reports). هر صفحه از کامپوننت‌های مشترک در <code>src/components</code> و ابزارهای <code>src/utils</code> استفاده می‌کند.</li>
      <li><strong>دادهٔ زنده:</strong> هوک <code>src/hooks/useStomp.js</code> یک کلاینت STOMP اشتراکی می‌سازد، به‌صورت خودکار به موضوع‌ها سابسکرایب می‌شود و چرخهٔ اتصال/اتصال مجدد را مدیریت می‌کند تا هر صفحه فقط موضوع‌ها و هندلر پیام خودش را تعریف کند.</li>
      <li><strong>پیکربندی و API:</strong> <code>src/context/SensorConfigContext.jsx</code> پیکربندی سنسورها را از طریق متدهای REST در <code>src/api/sensorConfig.js</code> بارگذاری/به‌روزرسانی می‌کند. مقادیر <code>VITE_API_BASE</code> و آدرس‌های WebSocket در <code>.env</code> تعیین می‌شوند.</li>
      <li><strong>آزمایش‌ها:</strong> تست‌های Vitest در پوشهٔ <code>tests</code> هستند و از کمکی‌هایی مثل <code>tests/utils/renderWithProviders</code> برای رندر کامپوننت‌ها با کانتکست‌های لازم استفاده می‌کنند.</li>
    </ul>
  </div>

  <div class="card">
    <h2>نکات مهم پیش از توسعه</h2>
    <ul>
      <li>اغلب صفحات فرض می‌کنند در <code>MainLayout</code> قرار می‌گیرند تا سایدبار و فیلترهای گزارش در دسترس باشند.</li>
      <li>هوک <code>useStomp</code> را قطع نکنید؛ اشتراک‌ها را با آرایهٔ موضوع‌ها کنترل کنید.</li>
      <li>متغیرهای محیطی برای WebSocket و REST را در <code>.env</code> تنظیم کنید تا به سرور درست متصل شوید.</li>
      <li>برای ساخت صفحات جدید، از کامپوننت‌های موجود در <code>src/components</code> و <code>src/pages/common</code> بهره بگیرید تا سبک و تجربهٔ کاربری یکدست بماند.</li>
    </ul>
  </div>

  <div class="card">
    <h2>مسیرهای پیشنهادی برای یادگیری بیشتر</h2>
    <ol>
      <li><strong>نرمال‌سازی داده‌ها:</strong> ابزارهای <code>src/pages/Overview/utils</code> نشان می‌دهند داده‌های خام سنسور چگونه به کارت‌ها و نمودارها تبدیل می‌شوند.</li>
      <li><strong>فیلترگذاری گزارش‌ها:</strong> به <code>src/pages/Reports/context/ReportsFiltersContext.jsx</code> و کامپوننت‌های مرتبط سر بزنید تا انتخاب بازه‌ها و شناسه‌های مرکب را ببینید.</li>
      <li><strong>الگوهای تست:</strong> پوشهٔ <code>tests/mocks</code> و <code>tests/utils</code> نمونه‌های خوبی از شبیه‌سازی API و رندر با Providerها هستند.</li>
    </ol>
  </div>

  <div class="card">
    <h2>نمودار UML (جریان داده و لایه‌ها)</h2>
    <p>برای رندر <code>mermaid</code> می‌توانید از افزونهٔ مرورگر یا ابزارهای آنلاین استفاده کنید.</p>
    <div class="mermaid">
      graph TD
        A[صفحه‌ها در src/pages] -->|می‌خوانند| B[کامپوننت‌های مشترک در src/components]
        A -->|اشتراک دادهٔ زنده| C[هوک useStomp]
        C -->|پیام‌های WebSocket/STOMP| D[(Broker)]
        A -->|دریافت/ثبت پیکربندی| E[SensorConfigContext]
        E -->|REST| F[sensorConfig.js]
        F -->|HTTP| G[(API Server)]
        A -->|مسیربندی| H[App.jsx + MainLayout]
        H --> I[سایدبار و فیلترهای گزارش]
        J[تست‌ها در tests] -->|شبیه‌سازی Providerها| A
    </div>
  </div>
</body>
</html>
